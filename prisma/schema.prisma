generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "mongodb"
  url      = env("PRISMA_DATABASE_URL")
}

enum CrawlStatusEnum {
  PENDING
  RUNNING
  FINISHED
  FAILED
}

enum CrawResultStatusEnum {
  SUCCESS
  ERROR
}

model crawl {
  id             String          @id @default(uuid(7)) @map("_id")
  cep_start      String
  cep_end        String
  status         CrawlStatusEnum
  total_ceps     Int             @default(0)
  processed_ceps Int             @default(0)
  success_ceps   Int             @default(0)
  failed_ceps    Int             @default(0)
  created_at     DateTime        @default(now())
  updated_at     DateTime        @updatedAt

  results crawl_result[]

  @@map("crawls")
}

model crawl_result {
  id            String               @id @default(uuid(7)) @map("_id")
  crawl_id      String
  cep           String
  data          Json?
  status        CrawResultStatusEnum
  error_message String?
  created_at    DateTime             @default(now())

  crawl crawl @relation(fields: [crawl_id], references: [id])

  @@map("crawl_results")
}

model cep {
  cep        String   @id @map("_id") // The 8-digit string
  found      Boolean  @default(true)
  logradouro String?
  compl      String? // complemento
  bairro     String?
  localidade String?
  uf         String?
  ibge       String?
  gia        String?
  ddd        String?
  siafi      String?
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  @@map("ceps")
}

model worker {
  id         String   @id @default(uuid(7)) @map("_id")
  hostname   String?
  role       String   @default("worker")
  last_seen  DateTime @default(now())
  created_at DateTime @default(now())

  @@map("workers")
}
